---
marp: true
theme: uncover
paginate: true
backgroundColor: #4C7F99
color: #fff
---
# 貪吃蛇小遊戲
## by pygame
---
# 為什麼要用pygame

---

# 在vscode終端打入以下指令
## 開啟vscode終端 : ctrl + ` 

```
pip install pygame
```
---
## 檢查pygame有沒有安裝在對應版本的python

```
python -m pygame.examples.aliens
```
---

## 按ctrl + shift + p 並輸入
```
Python: Select Interpreter
```
選擇和剛剛pygame對應版本的python就好囉!

---
# 前置作業完成，讓我們開始製作遊戲吧!~~

---
# 1. 畫出蛇蛇並使其動起來

---
## 建立遊戲視窗
```python
# 主迴圈外
import pygame # 導入函式庫

pygame.init() # 初始化pygame

window_x = 800 # 設定遊戲視窗大小
window_y = 600
window = pygame.display.set_mode((window_x, window_y))

pygame.display.set_caption("貪吃蛇小遊戲") # 定義視窗名稱
```
---
## 設定結束條件
```python
# 主迴圈
running = True
while running:
    # 偵測事件
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
pygame.quit() # 結束pygame
```
```python
# 返回一個儲存所有未處理事件的列表
pygame.event.get()
# 檢查輸入的事件是不是關閉視窗(結束遊戲)
if event.type == pygame.QUIT:
```
---
## 怎麼畫出方塊
```python
# 主迴圈內
window.fill(black) # 將畫布填滿黑色
pygame.draw.rect(window, green, (0, 0, unit, unit)) # 畫出30*30的綠色矩形
pygame.display.update() # 更新畫布
```
```python
pygame.draw.rect(surface, color, rect) # 劃出矩形的函式
# surface:要畫的地方
# color:(RGB)顏色
# rect:(左上角x座標, 左上角y座標, 高度, 寬度)
```
---
## 畫出蛇蛇
```python
# 在主迴圈之前設定初始蛇身
snake_body = [[2 * unit, 0], [unit, 0], [0, 0]]

# 在主迴圈裡面繪製蛇身
for body in snake_body:
    pygame.draw.rect(window, green, (body[0], body[1], unit, unit))
```
---
## 讓蛇蛇動起來
我們該怎麼讓蛇蛇**動起來呢**?
-->先伸長再縮短

---
蛇頭伸長蛇身縮短
```python
# 主迴圈外
snake_head = [2 * unit, 0]
# 主迴圈內
snake_head[0] += unit # 新的座標
snake_body.insert(0, list(snake_head)) # 插入新的座標/伸長
snake_body.pop() # 刪除最後的座標/縮短
```
insert(), pop()用法
```python
a_list.insert(index, element)
# index : 插入位置的索引
# element : 要插入的元素

a_list.pop(index)
# index : 要移除元素的索引值(默認為-1)
```
---
## 設定速度
```python
# 延遲1秒(單位為毫秒)
pygame.time.delay(1000)

# 在主迴圈之前
game_speed = 10 # 每秒跑10次迴圈

# 在主迴圈裡面
pygame.time.delay(1000 // game_speed)
```
---
# !!!待驗證!!!
他寫的感覺就是只會處理從開始到第一次運行間的事件而已，因為他沒有更新start_time
```python
# 紀錄迴圈開始前的時間
start_time = pygame.time.get_ticks()

# (迴圈當下執行的時間 - 迴圈開始前的時間) < (1000 // game_speed)
while pygame.time.get_ticks() - start_time < 1000 // game_speed:
    pygame.event.pump() # 處理佇列中的事件
```

---
## 改變蛇蛇移動方向

 \* 重點:新的移動方向和上次的移動方向不能差180度

---
```python
# 在主迴圈之前
direction = 'RIGHT' # 預設方向
new_direction = direction # 新方向

# 在主迴圈裡面

# 偵測鍵盤事件
if event.key == pygame.K_d:
    new_direction = 'RIGHT'
elif event.key == pygame.K_a:
    new_direction = 'LEFT'
elif event.key == pygame.K_s:
    new_direction = 'DOWN'
elif event.key == pygame.K_w:
    new_direction = 'UP'
```
如果不想用wasd想使用數字鍵旁的方向鍵  
可以把pygame.K_d改成pygame.K_RIGHT(以此類推)

---
```python
# 判斷轉彎方向是否合理
if new_direction == 'RIGHT' and direction != 'LEFT':
    direction = 'RIGHT'
elif new_direction == 'LEFT' and direction != 'RIGHT':
    direction = 'LEFT'
elif new_direction == 'DOWN' and direction != 'UP':
    direction = 'DOWN'
elif new_direction == 'UP' and direction != 'DOWN':
    direction = 'UP'
```
---
目前code
```python
import pygame

black = (0, 0, 0)
white = (255, 255, 255)
red = (255, 0, 0)
green = (0, 255, 0)
blue = (0, 0, 255)

pygame.init()
window_x = 800
window_y = 600
window = pygame.display.set_mode((window_x, window_y))
pygame.display.set_caption("貪吃蛇小遊戲")

unit = 30

snake_head = [0, 0]
snake_body = [[0, 0]]
snake_length = 3

direction = 'RIGHT'
new_direction = direction

game_speed = 10

running = True
while running:

    start_time = pygame.time.get_ticks()
    while pygame.time.get_ticks() - start_time < 1000 // game_speed:
        pygame.event.pump()

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_d:
                new_direction = 'RIGHT'
            elif event.key == pygame.K_a:
                new_direction = 'LEFT'
            elif event.key == pygame.K_s:
                new_direction = 'DOWN'
            elif event.key == pygame.K_w:
                new_direction = 'UP'

    if new_direction == 'RIGHT' and direction != 'LEFT':
        direction = 'RIGHT'
    elif new_direction == 'LEFT' and direction != 'RIGHT':
        direction = 'LEFT'
    elif new_direction == 'DOWN' and direction != 'UP':
        direction = 'DOWN'
    elif new_direction == 'UP' and direction != 'DOWN':
        direction = 'UP'

    if direction == 'RIGHT':
        snake_head[0] += unit
    elif direction == 'LEFT':
        snake_head[0] -= unit
    elif direction == 'DOWN':
        snake_head[1] += unit
    elif direction == 'UP':
        snake_head[1] -= unit

    snake_body.insert(0, list(snake_head))
    snake_body.pop()

    window.fill(black)

    for body in snake_body:
        pygame.draw.rect(window, green, (body[0], body[1], unit, unit))

    pygame.display.update()

pygame.quit()
```
---
# 2. 讓蛇蛇能吃果實長大

---

## random函式庫
```python
import random

# 隨機返回0到1之間不包含1的浮點數
random.random()

# 隨機返回0到10之間所有整數(包含10)
random.randint(0, 10)

# 返回從0到10之間的整數，每次的間隔為2，不包含10
r3 = [random.randrange(0, 10, 2) for k in range(10)]
print(r3)
# [0, 4, 6, 0, 8, 4, 8, 0, 8, 6]
r3 = []
for i in range(10):
    list.append(random.randrange(0, 10, 2))
print(r3)
```
---
## 生成果實
果實生成的座標以unit為間隔隨機生成
```python
# 在主迴圈之前 / 隨機初始座標
fruit = [random.randrange(0, window_x, unit),
         random.randrange(0, window_y, unit)]
# 在主迴圈裡面 / 繪製果實
pygame.draw.rect(window, red, (fruit[0], fruit[1], unit, unit))
```
---
## 避免果實長在蛇身上
```python
# 以遞迴重複確認
def new_fruit():
    new_pos = [random.randrange(0, window_x, unit),
               random.randrange(0, window_y, unit)]
    if new_pos in snake_body:
        return new_fruit()
    else:
        return new_pos
    
# 初始化果實座標
fruit = new_fruit()
```
---
## 長身體
1. 身體伸長 --> 蛇頭伸長，蛇身不變
2. 吃到果實就再產生一組新的果實座標
```python
if snake_head == fruit:
    fruit = [random.randrange(0, window_x, unit),
             random.randrange(0, window_y, unit)]
else:
    snake_body.pop()
```
---
## 碰撞判定
1. 不能撞到東西
```python
# x軸邊界
if not(0 <= snake_head[0] < window_x):
    break
# y軸邊界
if not(0 <= snake_head[1] < window_y):
    break
```
2. 不能碰到身體
```python
# snake_body[1:]不包含頭的座標
if snake_head in snake_body[1:]:
    break
```
---
## 目前程式碼
```python
import pygame
import random


def new_fruit():
    new_pos = [random.randrange(0, window_x, unit),
               random.randrange(0, window_y, unit)]
    if new_pos in snake_body:
        return new_fruit()
    else:
        return new_pos


black = (0, 0, 0)
white = (255, 255, 255)
red = (255, 0, 0)
green = (0, 255, 0)
blue = (0, 0, 255)

pygame.init()
window_x = 720
window_y = 630
window = pygame.display.set_mode((window_x, window_y))
pygame.display.set_caption("Pygame貪食蛇")

unit = 30

snake_head = [0, 0]
snake_body = [[0, 0]]
snake_length = 3
for i in range(snake_length - 1):
    snake_head[0] += unit
    snake_body.insert(0, list(snake_head))
direction = 'RIGHT'
new_direction = direction

fruit = new_fruit()

game_speed = 10

running = True
while running:

    start_time = pygame.time.get_ticks()
    while pygame.time.get_ticks() - start_time < 1000 // game_speed:
        pygame.event.pump()

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_d:
                new_direction = 'RIGHT'
            elif event.key == pygame.K_a:
                new_direction = 'LEFT'
            elif event.key == pygame.K_s:
                new_direction = 'DOWN'
            elif event.key == pygame.K_w:
                new_direction = 'UP'

    if new_direction == 'RIGHT' and direction != 'LEFT':
        direction = 'RIGHT'
    elif new_direction == 'LEFT' and direction != 'RIGHT':
        direction = 'LEFT'
    elif new_direction == 'DOWN' and direction != 'UP':
        direction = 'DOWN'
    elif new_direction == 'UP' and direction != 'DOWN':
        direction = 'UP'

    if direction == 'RIGHT':
        snake_head[0] += unit
    elif direction == 'LEFT':
        snake_head[0] -= unit
    elif direction == 'DOWN':
        snake_head[1] += unit
    elif direction == 'UP':
        snake_head[1] -= unit

    snake_body.insert(0, list(snake_head))

    if snake_head == fruit:
        fruit = new_fruit()
    else:
        snake_body.pop()

    if not (0 <= snake_head[0] < window_x):
        break
    if not(0 <= snake_head[1] < window_y):
        break
    if snake_head in snake_body[1:]:
        break

    window.fill(black)

    for body in snake_body:
        pygame.draw.rect(window, green, (body[0], body[1], unit, unit))

    pygame.draw.rect(window, red, (fruit[0], fruit[1], unit, unit))

    pygame.display.update()

pygame.quit()
```
---